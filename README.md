rerere
======

###これは何？
rerereは、複数行の被検索文字列に対して、複数行の正規表現を適用します。グループ化した正規表現にマッチした箇所を一気に変数に代入して結果として返します。

被検索文字列のフォーマット情報とロジック本体を分離することが目的です。

###何が嬉しいの？
- 被検索文字列を解析するためのコード、を書かなくて良くなります。代わりに構造を正規表現と簡単な命令で表現します。
- 被検索文字列のフォーマットに変更があったときは、構造の部分に手を入れるだけです。


### 具体例
楽天の自動受注メールの構造を表現
```
pattern = 
'''
\[受注番号\]\s*([0-9-]+)<<=order_no>>
\[日時\]\s*([0-9]{4}\-[0-9]{2}\-[0-9]{2}\s[0-9]{2}:[0-9]{2}:[0-9]{2})<<=insert_date>>
\[注文者\]\s*(\S+)<<=name>> \((\S+)<<=name_kana>>\) 様
\s*〒([0-9]{3}\-[0-9]{4})<<=zip>>\s*(\S+$)<<=address>>
\s*\(TEL\)\s([0-9-]+)<<=phone_number>>

\[商品\]
(^.+$)<<=item_name_1>>
価格\s*([0-9,]+)<<=item_price_1>>\(円\) x ([0-9,]+)<<=item_number_1>>\(個\) = ([0-9,]+)<<=item_total_1>>\(円\)
獲得ポイント

<<@loop pattern='\*\*\*\*\*' type='until' id='test'>>
\-\-\-\-\-
(^.+$)<<=item_name_next_%test%>>
価格\s*([0-9,]+)<<=item_price_next_%test%>>\(円\) x ([0-9,]+)<<=item_number_next_%test%>>\(個\) = ([0-9,]+)<<=item_total_next_%test%>>\(円\)
獲得ポイント
<<@endloop id='test'>>

小計\s*([0-9,]+)<<=total_sub>>\(円\)
消費税\s*([0-9]+)<<=tax>>\(円\)
送料\s*([0-9,]+)<<=postage>>\(円\)
\-\-\-\-\-\-
合計\s*([0-9,]+)<<=total>>\(円\)
'''
```

使い方
```
ret = rerere.search(pattern, rakuten_mail_plain_txt)
print(ret['order_no'])  # 受注番号
print(ret['item_name_1']  # 1つ目の商品名
print(ret['item_name_next_1']  # 2つ目の商品名
```
